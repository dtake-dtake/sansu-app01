<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title></title>
  
  <link rel="stylesheet" href="../common.css"> <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

</head>
<script>
(function () {
  const P = new URLSearchParams(location.search);
  const mod = P.get('mod'); // 例: /drills/1nen/tashizan_10made/drill.js

  function applyMetaAndStart() {
    // drill.js が定義するメタ情報（任意項目は存在チェックで反映）
    const meta = window.drillMeta || {};
    const h1 = document.getElementById('main-title');
    const h2 = document.getElementById('sub-title');

    if (meta.main) h1.textContent = meta.main;
    if (meta.sub)  { h2.textContent = meta.sub; if (!document.title) document.title = meta.sub; }

    if (meta.appId) document.body.dataset.appId = meta.appId;
    if (meta.theme) document.body.dataset.theme = meta.theme; // 例: theme_sky

    const cfg = {};
    if (meta.pointsPerQuestion != null)  cfg.pointsPerQuestion  = meta.pointsPerQuestion;
    if (meta.timeLimitPerQuestion != null) cfg.timeLimitPerQuestion = meta.timeLimitPerQuestion;
    if (meta.starThresholds) cfg.starThresholds = meta.starThresholds;

    // 共通エンジン起動（common.js）
    initializeDrillApp(cfg);
  }

  if (mod) {
    // ドリルJSを動的ロード
    const s = document.createElement('script');
    s.src = mod;
    s.onload  = applyMetaAndStart;
    s.onerror = () => {
      const r = document.getElementById('result');
      if (r) r.textContent = 'ドリルファイルを読み込めませんでした。URL（mod）をご確認ください。';
    };
    document.body.appendChild(s);
  } else {
    // modなしでも、手動でwindow.generateProblemsやdrillMetaが定義されていれば起動
    if (window.generateProblems || window.drillMeta) applyMetaAndStart();
    else {
      const r = document.getElementById('result');
      if (r) r.textContent = 'このテンプレートを使うには、?mod=/path/to/drill.js を指定してください。';
    }
  }
})();
</script>

<body>
  <h1 id="main-title"></h1>
  <h2 id="sub-title"></h2>

  <div id="start-area" style="text-align:center; margin:40px 0;">
    <button id="start-btn">スタート！</button>
  </div>

  <div id="problems-section" style="display:none;">
    <div id="problems-wrapper"></div>
    <div class="button-area">
      <button id="check-answers">まるつけ</button>
      <button id="retry">もういちど</button>
    </div>
  </div>

  <div id="result-area">
    <div id="result"></div>
    <div id="highScoreArea">ハイスコア：<span id="highScoreValue">0</span> てん <button id="reset-highscore">リセット</button></div>
    <div id="dailyCountArea">今日のクリア：<span id="dailyCountValue">0</span> かい</div>
    <div id="monthlyCountArea">今月のクリア：<span id="monthlyCountValue">0</span> かい</div>
    <div id="clearCountArea">合計クリア：<span id="clearCountValue">0</span> かい</div>
    <div id="overallStatusArea"><span id="overallStatusText">ステータス：</span><span id="overallStars" class="status-stars">―</span></div>
    <div id="history-area">りれき（１０件）<br><ul id="history-list"></ul></div>
  </div>


  <script src="../themes.js"></script>
  
  <script src="../common.js"></script>
  
</body>
</html>