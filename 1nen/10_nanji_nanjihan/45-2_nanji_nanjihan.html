<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãªã‚“ã˜ãƒ»ãªã‚“ã˜ã¯ã‚“ï¼ˆ5å•ï¼‹ã‚¹ã‚³ã‚¢ï¼‰</title>
  <!-- æ—¢å­˜ã®å…±é€šCSSã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã“ã®ã¾ã¾ -->
  <link rel="stylesheet" href="common.css" />
  <style>
    /* æ™‚è¨ˆUIï¼ˆæ—¢å­˜ãƒ™ãƒ¼ã‚¹ï¼‰ */
    #wrap{max-width:1100px;margin:0 auto;background:#fff;border:2px solid #ccc;box-shadow:3px 3px 8px rgba(0,0,0,.2);padding:18px;border-radius:14px}
    .topRow{display:grid;grid-template-columns:minmax(420px,1fr) 360px;gap:24px;align-items:start}
    .qbox{border:3px solid #39b0a5;border-radius:12px;padding:18px;line-height:2;font-size:2.2rem;background:#fbfffd}
    .rightBox{display:flex;flex-direction:column;align-items:center}
    .label{font-size:2.2rem;margin-bottom:8px}

    /* æ™‚è¨ˆ */
    .clock{width:320px;aspect-ratio:1/1;margin:0 auto}
    .face{fill:#fff;stroke:#58a3d3;stroke-width:10}
    .tick-min{stroke:#89bedd;stroke-width:2}
    .tick-hr{stroke:#4a93bf;stroke-width:4}
    .num{font-size:22px;fill:#222;text-anchor:middle;dominant-baseline:middle}
    .hand-min{stroke:#ff7f2a;stroke-width:8;stroke-linecap:round;transform-origin:160px 160px}
    .hand-hr{stroke:#111;stroke-width:10;stroke-linecap:round;transform-origin:160px 160px}
    .pin{fill:#ed4a38}

    /* è§£ç­”æ¬„ */
    .answerBox{margin-top:18px;text-align:center;font-size:2.2rem}
    .field{width:120px;font-size:2.8rem;padding:10px 12px;text-align:right;margin:0 8px;border:2px solid #bbb;border-radius:10px;background:#fff}
    .selectField{min-width:180px;font-size:2.4rem;padding:8px 12px;margin-left:8px;border:2px solid #bbb;border-radius:10px;background:#fff}
    .field:focus,.selectField:focus{outline:none;border-color:#2cc4ff;box-shadow:0 0 0 3px rgba(44,196,255,.2)}
    .incorrect{border-color:#d32f2f !important;background:#ffecec}
    .correct{border-color:#0a7a00 !important;background:#f1fff1}
    .btns{margin-top:14px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}

    /* ãƒã‚¤ãƒ†ã‚£ãƒ–selectã®ç°¡æ˜“ã€Œå¼·åˆ¶ã‚ªãƒ¼ãƒ—ãƒ³ã€ç”¨ */
    select[size]{padding:6px 10px;}

    /* ç´™å¹é›ªã‚­ãƒ£ãƒ³ãƒã‚¹ */
    #confetti-canvas{position:fixed;inset:0;pointer-events:none;z-index:9999;display:none;}

    /* æ—¢å®šã®ã‚¹ã‚³ã‚¢è¡Œã¯éè¡¨ç¤ºã«ï¼ˆå‚è€ƒè¡¨ç¤ºã®ã¿ï¼‰ */
    #scoreLine { display: none !important; }

    /* ãƒ˜ãƒƒãƒ€ã®çµ±è¨ˆè¡¨ç¤º */
    #statsBox{
      display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:16px 0;
      font-size:1.6rem; text-align:center;
    }
    #statsBox .stat{background:#f1faff;border:1px solid #bfe4ff;border-radius:10px;padding:6px 8px}
    #result{margin-top:20px;text-align:center;font-size:2.2rem}
  </style>
</head>
<body>
  <h1 id="main-title">ï¼‘ï¼ã€€ãªã‚“ã˜ã€€ãªã‚“ã˜ã¯ã‚“</h1>
  <h2 id="sub-title">ã¨ã‘ã„ã®ã€€ã‚ˆã¿ã‹ãŸ</h2>

  <!-- ã‚¹ã‚¿ãƒ¼ãƒˆ -->
  <div id="start-area" style="text-align:center; margin:20px 0;">
    <button id="start-btn" autofocus>ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
  </div>

  <!-- ã‚¯ãƒªã‚¢å›æ•°ãƒ»HSãƒ»å±¥æ­´ -->
  <div id="statsBox" aria-label="è¨˜éŒ²ã‚¨ãƒªã‚¢">
    <div class="stat">HS: <span id="highScoreValue">0</span></div>
    <div class="stat">ã‚¯ãƒªã‚¢å›æ•°: <span id="clearCountValue">0</span></div>
    <div class="stat">ä»Šæœˆ: <span id="monthlyCountValue">0</span></div>
    <div class="stat">ä»Šæ—¥: <span id="dailyCountValue">0</span></div>
  </div>

  <!-- å•é¡Œ -->
  <div id="problems-section" style="display:none;">
    <div id="problems-wrapper">
      <div id="wrap">
        <div class="topRow">
          <div class="qbox">
            <div id="qText">ã¨ã‘ã„ã¯ <strong>ãªã‚“ã˜ï¼Ÿãªã‚“ã˜ã¯ã‚“ï¼Ÿ</strong></div>
            <div id="progress"   style="margin-top:8px;color:#1e88e5;font-weight:bold;"></div>
            <!-- ã‚¹ã‚³ã‚¢è¡Œï¼ˆãƒ™ãƒ¼ã‚¹ç‚¹ã®ã¿ã€100ç‚¹æº€ç‚¹ï¼‰ -->
            <div id="scoreLine" style="margin-top:4px;color:#00695c;font-weight:bold;">
              ã‚¹ã‚³ã‚¢ï¼š<span id="scoreValue">0</span> / 100
            </div>
          </div>
          <div class="rightBox">
            <div class="label">ã¨ã‘ã„</div>
            <svg class="clock" id="clock" aria-label="æ™‚è¨ˆè¡¨ç¤º"></svg>
          </div>
        </div>

        <div class="answerBox" aria-label="è§£ç­”æ¬„">
          ç­”ãˆï¼š <input id="ansH" class="field" type="number" inputmode="numeric" min="1" max="12" aria-label="æ™‚"> æ™‚
          <select id="kindSelect" class="selectField" aria-label="ã˜ï¼ã˜ã¯ã‚“">
            <option value="" selected disabled>ãˆã‚‰ã‚“ã§ã­ â–¾</option>
            <option value="just">ã˜</option>
            <option value="half">ã˜ã¯ã‚“</option>
          </select>
          <div class="btns">
            <button id="checkBtn">ã¾ã‚‹ã¤ã‘</button>
            <button id="nextBtn" disabled>æ¬¡ã®å•é¡Œ</button>
            <button id="retry">ã‚‚ã†ä¸€åº¦</button>
          </div>
          <div id="perQuestionResult" style="margin-top:10px;"></div>
        </div>

        <div id="result"></div>

        <div id="history-area" style="margin-top:18px">
          ã‚Šã‚Œãï¼ˆï¼‘ï¼ä»¶ï¼‰<br>
          <ul id="history-list" style="margin:6px 0 0 18px"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ç´™å¹é›ªç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <canvas id="confetti-canvas"></canvas>

<script>
/* ========= ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ï¼ˆå…±é€šã‚µãƒ³ãƒ—ãƒ«ã¨äº’æ›ï¼‰ ========= */
/* â˜… ã“ã“ã‚’ app_data.json ã® id ã¨å®Œå…¨ä¸€è‡´ã«ã™ã‚‹ï¼ˆé‡è¦ï¼‰ */
const APP_ID = "1n-nanji-nanjihan";

const KEY_HS             = `${APP_ID}:hs`;
const KEY_HISTORY        = `${APP_ID}:history`;
const KEY_CLEAR          = `${APP_ID}:clearCount`;
const KEY_MONTHLY_PREFIX = `${APP_ID}:monthlyClear-`;
const KEY_DAILY_PREFIX   = `${APP_ID}:dailyClear-`;

/* ========= ã‚«ã‚¦ãƒ³ã‚¿ï¼ã‚¹ã‚³ã‚¢é–¢é€£ ========= */
let totalClear = 0, monthly = 0, daily = 0, highScore = 0;

function loadPersistent(){
  const today = new Date().toISOString().slice(0,10);
  const month = new Date().toISOString().slice(0,7);
  highScore   = +(localStorage.getItem(KEY_HS) || 0);
  totalClear  = +(localStorage.getItem(KEY_CLEAR)||0);
  monthly     = +(localStorage.getItem(KEY_MONTHLY_PREFIX+month)||0);
  daily       = +(localStorage.getItem(KEY_DAILY_PREFIX+today)||0);
}
function savePersistent(){
  const today = new Date().toISOString().slice(0,10);
  const month = new Date().toISOString().slice(0,7);
  localStorage.setItem(KEY_HS, String(highScore));
  localStorage.setItem(KEY_CLEAR, String(totalClear));
  localStorage.setItem(KEY_MONTHLY_PREFIX+month, String(monthly));
  localStorage.setItem(KEY_DAILY_PREFIX+today, String(daily));
}
function saveHistoryScore(score){
  const h = JSON.parse(localStorage.getItem(KEY_HISTORY)||'[]');
  h.unshift({ datetime: new Date().toLocaleString(), score });
  if(h.length>10) h.pop();
  localStorage.setItem(KEY_HISTORY, JSON.stringify(h));
}
function refreshHeaderUI(){
  document.getElementById('highScoreValue').textContent   = highScore;
  document.getElementById('clearCountValue').textContent   = totalClear;
  document.getElementById('monthlyCountValue').textContent = monthly;
  document.getElementById('dailyCountValue').textContent   = daily;
  const h = JSON.parse(localStorage.getItem(KEY_HISTORY)||'[]');
  document.getElementById('history-list').innerHTML =
    h.map(x=>`<li>${x.datetime}ï¼š${x.score}ã¦ã‚“</li>`).join('');
}

/* ========= å•é¡Œãƒ»UIè¦ç´  ========= */
const qText       = document.getElementById("qText");
const progressEl  = document.getElementById("progress");
const scoreValue  = document.getElementById("scoreValue");
const ansH        = document.getElementById("ansH");
const kindSelect  = document.getElementById("kindSelect");
const checkBtn    = document.getElementById("checkBtn");
const nextBtn     = document.getElementById("nextBtn");
const perResult   = document.getElementById("perQuestionResult");
const startBtn    = document.getElementById("start-btn");
const startArea   = document.getElementById("start-area");
const problemsSec = document.getElementById("problems-section");
const retryBtn    = document.getElementById("retry");
const resultBox   = document.getElementById("result");

const clock = buildClock(document.getElementById("clock"));

/* ========= ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š ========= */
const TOTAL = 5;
// 35-2å¼: åˆè¨ˆ = 100 + (ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ  / è¨­å®šã‚¿ã‚¤ãƒ ) Ã— 100
// 1å•ã‚ãŸã‚Šã®ã€Œè¨­å®šã‚¿ã‚¤ãƒ ã€ï¼ˆç§’ï¼‰ã‚’æ±ºã‚ã‚‹ã€‚ä¾‹: 8ç§’/å• â†’ å…¨ä½“ã§ 40ç§’
const TIME_LIMIT_PER_Q = 8;  // â†ãŠå¥½ã¿ã§ 6ã€œ10 ã«èª¿æ•´

let idx = 0, problem = null, startTime = 0, wrongTotal = 0;
let sessionScore = 0, currentMistakes = 0;

function randPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function createProblem(){
  const hour = randPick([1,2,3,4,5,6,7,8,9,10,11,12]);
  const isHalf = Math.random() < 0.5;
  const m = isHalf ? 30 : 0;
  return { h: hour, m, isHalf, answerH: hour, answerKind: isHalf ? "half" : "just" };
}

function renderNew(){
  problem = createProblem();
  clock.setTime(problem.h, problem.m);
  qText.innerHTML = `ã¨ã‘ã„ã¯ <strong>ãªã‚“ã˜ï¼Ÿãªã‚“ã˜ã¯ã‚“ï¼Ÿ</strong>`;
  progressEl.textContent = `ã®ã“ã‚Šã€€${TOTAL-idx}ã‚‚ã‚“`;

  currentMistakes = 0;
  ansH.value=""; kindSelect.value="";
  ansH.classList.remove("incorrect","correct");
  kindSelect.classList.remove("incorrect","correct");
  perResult.textContent=""; nextBtn.disabled=true;

  setTimeout(()=>ansH.focus(),0);
}

function check(){
  ansH.classList.remove("incorrect","correct");
  kindSelect.classList.remove("incorrect","correct");
  const h = Number(ansH.value.trim());
  const kind = kindSelect.value;
  let okForm = true;
  if(!Number.isInteger(h) || h<1 || h>12){ okForm=false; ansH.classList.add("incorrect"); }
  if(kind !== "just" && kind !== "half"){ okForm=false; kindSelect.classList.add("incorrect"); }
  if(!okForm){
    perResult.textContent="æ•°å­—ã‚’å…¥ã‚Œã¦ã€ã©ã¡ã‚‰ã‹é¸ã‚“ã§ã­ã€‚";
    perResult.style.color="#b20000"; nextBtn.disabled=true;
    if(ansH.classList.contains("incorrect")){ ansH.focus(); ansH.select(); } else { kindSelect.focus(); }
    return;
  }
  const ok = (h===problem.answerH) && (kind===problem.answerKind);
  if(ok){
    perResult.textContent="ã€‡ ã›ã„ã‹ã„ï¼ã€Œæ¬¡ã®å•é¡Œã€ã‚’æŠ¼ã—ã¦ã­ã€‚";
    perResult.style.color="#0a7a00";
    ansH.classList.add("correct"); kindSelect.classList.add("correct");
    nextBtn.disabled=false; nextBtn.focus();
  }else{
    currentMistakes++; wrongTotal++;
    perResult.textContent="Ã— ã‚‚ã†ã„ã¡ã©è€ƒãˆã‚ˆã†ã€‚";
    perResult.style.color="#b20000";
    if(h!==problem.answerH) ansH.classList.add("incorrect");
    if(kind!==problem.answerKind) kindSelect.classList.add("incorrect");
    nextBtn.disabled=true;
    if(h!==problem.answerH){ ansH.focus(); ansH.select(); } else { kindSelect.focus(); }
  }
}

function next(){
  if(nextBtn.disabled) return; // æ­£è§£ã—ãªã„ã¨é€²ã‚ãªã„
  idx++;
  if(idx < TOTAL){ renderNew(); }
  else { finishSession(); }
}

/* ã‚¹ã‚³ã‚¢â†’â˜… å¤‰æ›ï¼ˆé–¾å€¤ã¯é‹ç”¨ã«åˆã‚ã›ã¦èª¿æ•´å¯ï¼‰ */
function starsFromScore(s){
  if (s >= 180) return "â˜…â˜…â˜…â˜…â˜…";
  if (s >= 160) return "â˜…â˜…â˜…â˜…â˜†";
  if (s >= 140) return "â˜…â˜…â˜…â˜†â˜†";
  if (s >= 120) return "â˜…â˜…â˜†â˜†â˜†";
  if (s >= 100) return "â˜…â˜†â˜†â˜†â˜†";
  return "â€•";
}

function finishSession(){
  const elapsed = (Date.now() - startTime) / 1000;          // ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ (ç§’)
  const timeLimit = TOTAL * TIME_LIMIT_PER_Q;                // è¨­å®šã‚¿ã‚¤ãƒ (ç§’)
  const baseScore = TOTAL * 20;                              // 100ç‚¹å›ºå®š
  const timeBonus = Math.floor((elapsed / timeLimit) * 100); // (çµŒé/è¨­å®š)Ã—100
  const total = baseScore + timeBonus;

  const isNewHS = total > highScore;
  if (isNewHS) { highScore = total; }

  // â˜… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¿å­˜ï¼ˆindex ã®è¡¨ç¤ºã«å¿…è¦ï¼‰
  const stars = starsFromScore(total);
  localStorage.setItem(`${APP_ID}:status`, stars);
  localStorage.setItem(`${APP_ID}:overallStatus`, stars); // äº’æ›ã‚­ãƒ¼

  // ã‚¯ãƒªã‚¢å›æ•°ã‚«ã‚¦ãƒ³ã‚¿ã‚’+1
  incrementClearCounters();

  // HSãƒ»å„ç¨®ã‚«ã‚¦ãƒ³ã‚¿ãƒ»å±¥æ­´ã‚’ä¿å­˜ãƒ»è¡¨ç¤ºæ›´æ–°
  savePersistent();
  saveHistoryScore(total);
  refreshHeaderUI();

  // çµæœè¡¨ç¤ºï¼ˆå‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸å¼ï¼‰
  resultBox.innerHTML =
    `ğŸ‰ å…¨å•æ­£è§£ï¼ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰<br>` +
    `ã‚¹ã‚³ã‚¢: <strong>${total}ç‚¹</strong> (ã‚¿ã‚¤ãƒ : <strong>${elapsed.toFixed(1)}</strong> ç§’)` +
    (isNewHS ? `<br><span style="color:#e53935;font-weight:bold;">âœ¨ ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ï¼</span>` : ``);
  resultBox.style.color = '#d32f2f';
  resultBox.style.fontWeight = '700';

  // ç´™å¹é›ª
  celebrate(isNewHS ? 2200 : 1500);

  // ç”»é¢æˆ»ã—
  startArea.style.display=""; problemsSec.style.display="none";
}

function incrementClearCounters() {
  const today = new Date().toISOString().slice(0,10);
  const month = new Date().toISOString().slice(0,7);

  const total = +(localStorage.getItem(KEY_CLEAR) || 0) + 1;
  const m     = +(localStorage.getItem(KEY_MONTHLY_PREFIX + month) || 0) + 1;
  const d     = +(localStorage.getItem(KEY_DAILY_PREFIX   + today) || 0) + 1;

  localStorage.setItem(KEY_CLEAR, String(total));
  localStorage.setItem(KEY_MONTHLY_PREFIX + month, String(m));
  localStorage.setItem(KEY_DAILY_PREFIX   + today, String(d));

  totalClear = total; monthly = m; daily = d;
}

function start(){
  idx=0; wrongTotal=0; sessionScore=0; currentMistakes=0;
  scoreValue.textContent = '0';
  startTime = Date.now();
  startArea.style.display="none"; problemsSec.style.display="block";
  renderNew();
}

function retry(){ start(); }

/* ========= ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³æŒ™å‹• ========= */
window.addEventListener('DOMContentLoaded', ()=>{
  try{ startBtn.focus(); }catch(e){}
  loadPersistent();
  refreshHeaderUI();
});
startBtn.addEventListener("click", start);
startBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); start(); } });

ansH.addEventListener("input", ()=>{ ansH.classList.remove("incorrect","correct"); perResult.textContent=""; nextBtn.disabled=true; });
ansH.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp"||e.key==="ArrowDown"){ e.preventDefault(); }
  if(e.key==="Enter"||e.key==="ArrowRight"||e.key==="ArrowDown"){ e.preventDefault(); openSelectDropdown(kindSelect); kindSelect.focus(); }
});
function openSelectDropdown(sel){
  if(typeof sel.showPicker === "function"){ try{ sel.showPicker(); return; }catch(e){} }
  if(!sel.hasAttribute('size')) sel.setAttribute('size', sel.options.length);
}
function closeSelectDropdown(sel){ if(sel.hasAttribute('size')) sel.removeAttribute('size'); }
kindSelect.addEventListener("focus", ()=>{
  openSelectDropdown(kindSelect);
  if(kindSelect.value===""){ kindSelect.selectedIndex = 1; } // ã˜
});
kindSelect.addEventListener("keydown", e=>{
  if(e.key==="Enter"||e.key===" "||e.key==="ArrowRight"){ e.preventDefault(); checkBtn.focus(); }
});
kindSelect.addEventListener("blur", ()=> closeSelectDropdown(kindSelect));
checkBtn.addEventListener("click", check);
nextBtn.addEventListener("click", next);
retryBtn.addEventListener("click", retry);

/* ========= æ™‚è¨ˆæç”» ========= */
function buildClock(svg){
  const NS = "http://www.w3.org/2000/svg";
  function E(n){ return document.createElementNS(NS,n); }
  svg.innerHTML = "";
  svg.setAttribute("viewBox","0 0 320 320");

  const face = E("circle"); face.setAttribute("cx",160); face.setAttribute("cy",160); face.setAttribute("r",150); face.setAttribute("class","face"); svg.appendChild(face);

  // ç›®ç››
  for(let i=0;i<60;i++){
    const tick = E("line");
    const a = (Math.PI*2) * (i/60);
    const R1 = i%5===0 ? 135 : 145;
    const R2 = 150;
    tick.setAttribute("x1", 160 + R1*Math.sin(a));
    tick.setAttribute("y1", 160 - R1*Math.cos(a));
    tick.setAttribute("x2", 160 + R2*Math.sin(a));
    tick.setAttribute("y2", 160 - R2*Math.cos(a));
    tick.setAttribute("class", i%5===0 ? "tick-hr" : "tick-min");
    svg.appendChild(tick);
  }
  // æ•°å­—
  for(let h=1;h<=12;h++){
    const a = (Math.PI*2) * (h/12);
    const t = E("text"); t.textContent = h; t.setAttribute("class","num");
    t.setAttribute("x", 160 + 115*Math.sin(a));
    t.setAttribute("y", 160 - 115*Math.cos(a));
    svg.appendChild(t);
  }

  const handMin = E("line"); handMin.setAttribute("x1",160); handMin.setAttribute("y1",160); handMin.setAttribute("x2",160); handMin.setAttribute("y2",60); handMin.setAttribute("class","hand-min"); svg.appendChild(handMin);
  const handHr  = E("line"); handHr.setAttribute("x1",160); handHr.setAttribute("y1",160); handHr.setAttribute("x2",160); handHr.setAttribute("y2",90); handHr.setAttribute("class","hand-hr"); svg.appendChild(handHr);
  const pin = E("circle"); pin.setAttribute("cx",160); pin.setAttribute("cy",160); pin.setAttribute("r",6); pin.setAttribute("class","pin"); svg.appendChild(pin);

  function setTime(h,m){
    const degMin = m*6;
    const degHr  = (h%12)*30 + m*0.5;
    handMin.style.transform = `rotate(${degMin}deg)`;
    handHr.style.transform  = `rotate(${degHr}deg)`;
  }
  return { setTime };
}

/* ========= ã‹ã‚“ãŸã‚“ç´™å¹é›ª ========= */
function celebrate(ms=1500){
  const canvas = document.getElementById('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = innerWidth; canvas.height = innerHeight; canvas.style.display='block';
  const N = 120, parts=[];
  for(let i=0;i<N;i++){
    parts.push({x:Math.random()*canvas.width,y:Math.random()*-canvas.height,vx:(Math.random()*2-1)*1.2,vy:2+Math.random()*3,r:2+Math.random()*5,c:`hsl(${Math.random()*360},90%,60%)`});
  }
  const t0 = performance.now();
  (function loop(t){
    const dt = (t-t0);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const p of parts){
      p.x += p.vx; p.y += p.vy; if(p.y>canvas.height){ p.y=-10; p.x=Math.random()*canvas.width; }
      ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
    }
    if(dt < ms) requestAnimationFrame(loop); else canvas.style.display='none';
  })(t0);
}
</script>
</body>
</html>
