<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="app-title" content="(2けた)×(2けた)の筆算（くりあがりなし）">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>(2けた)×(2けた)の筆算（くりあがりなし）</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800&display=swap" rel="stylesheet">
  <style>
    /* ▼▼▼ テーマ：サニー・オレンジ（元気な太陽） ▼▼▼ */
    :root {
      --c-bg-main: #FFF3E0;         /* 薄いオレンジ */
      --c-card-bg: #ffffff;
      --c-grid-border: #B0BEC5;
      --c-line-strong: #5D4037;     /* こげ茶色 */
      
      --c-primary: #EF6C00;         /* 濃いオレンジ */
      --c-primary-light: #FFE0B2;   /* 明るいオレンジ */
      --c-accent: #009688;          /* ティール（青緑）- アクセント */
      --c-button-bg: #F57C00;
      
      --c-correct-bg: #E8F5E9;
      --c-wrong-bg: #FFEBEE;
      --c-text-correct: #2E7D32;
      --c-text-wrong: #D32F2F;

      --font-family: "M PLUS Rounded 1c", sans-serif;
      --cell-size: 58px;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--c-bg-main);
      color: #37474F;
      padding: 20px;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
      margin: 0;
      -webkit-tap-highlight-color: transparent;
      
      /* 背景パターン：ドット */
      background-image: radial-gradient(var(--c-primary-light) 20%, transparent 20%);
      background-size: 20px 20px;
    }

    h1 { font-size: 1.5rem; color: var(--c-primary); margin: 10px 0; text-align: center; background:rgba(255,255,255,0.9); padding:5px 15px; border-radius:10px; border: 2px solid var(--c-primary-light);}
    
    .page-header {
      display: flex; gap: 10px; align-items: center; margin-bottom: 20px;
      background: #fff; padding: 5px 15px; border-radius: 20px;
      border: 2px solid var(--c-primary);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #game-area {
      display: none; width: 100%; max-width: 600px;
      flex-direction: column; align-items: center;
    }

    .problem-card {
      background: var(--c-card-bg);
      border-radius: 10px;
      padding: 40px 30px; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      display: flex; flex-direction: column; align-items: center;
      margin-bottom: 20px;
      position: relative;
      border: 3px solid var(--c-primary-light);
    }

    .problem-number-display {
      font-weight: bold; font-size: 1.2rem; color: #fff;
      margin-bottom: 15px;
      background: var(--c-primary);
      padding: 5px 20px; border-radius: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* ▼▼▼ 筆算グリッド ▼▼▼ */
    .hissan-grid {
      display: grid;
      grid-template-columns: repeat(5, var(--cell-size));
      gap: 0;
      border-top: 1px solid var(--c-grid-border);
      border-left: 1px solid var(--c-grid-border);
      font-size: 2.4rem; font-weight: bold; line-height: 1; color: #333;
      background-color: #fff;
      position: relative;
      margin: 10px 0;
    }

    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
      display: flex; align-items: center; justify-content: center;
      box-sizing: border-box;
      border-right: 1px solid var(--c-grid-border);
      border-bottom: 1px solid var(--c-grid-border);
      position: relative; 
    }

    .line-container {
      grid-column: 1 / -1; height: 0; position: relative; z-index: 5;
    }
    .line-bar {
      position: absolute; top: -2px; left: 0; right: 0; height: 3px; background-color: var(--c-line-strong);
    }

    .input-cell {
      width: 100%; height: 100%;
      font-family: inherit; font-size: inherit; font-weight: inherit;
      text-align: center;
      border: none; border-radius: 0;
      background-color: transparent;
      color: var(--c-primary); outline: none; padding: 0; margin: 0;
      -moz-appearance: textfield;
    }
    .input-cell:focus {
      background-color: rgba(255, 243, 224, 0.5);
      box-shadow: inset 0 0 0 3px var(--c-accent);
    }
    .input-cell::selection { background-color: rgba(0, 150, 136, 0.3); }

    .correct-bg { background-color: var(--c-correct-bg) !important; }
    .wrong-bg { background-color: var(--c-wrong-bg) !important; }
    
    .input-cell.correct { color: var(--c-text-correct); }
    .input-cell.wrong { color: var(--c-text-wrong); }

    .symbol { font-family: sans-serif; font-size: 1.8rem; color: #555; }

    #start-area, #result-area {
      background: #fff; padding: 30px; border-radius: 15px;
      text-align: center; border: 4px solid var(--c-primary);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      max-width: 550px; width: 90%; margin-top: 20px;
    }

    .btn-area { margin-top: 20px; display: flex; justify-content: center; }
    button {
      font-family: var(--font-family);
      font-size: 1.3rem; padding: 12px 40px;
      border: none; border-radius: 50px;
      background-color: var(--c-button-bg); color: #fff;
      cursor: pointer; font-weight: bold;
      box-shadow: 0 5px 0 #E65100;
      transition: transform 0.1s;
    }
    button:active { transform: translateY(4px); box-shadow: none; }
    
    #check-btn { background-color: var(--c-accent); box-shadow: 0 5px 0 #00695C; min-width: 200px; }
    #check-btn:active { transform: translateY(4px); box-shadow: none; }

    .star-rank { font-size: 3.5rem; color: #FFD700; text-shadow: 2px 2px 0 #FFA000; margin: 10px 0; }
    
    .status-container {
        display: flex; justify-content: space-around; flex-wrap: wrap;
        background-color: #FFF3E0; border-radius: 10px;
        padding: 10px; margin: 15px 0;
        border: 2px solid var(--c-primary-light);
    }
    .status-item {
        margin: 5px 10px; font-size: 0.95rem; color: #37474F;
        display: flex; flex-direction: column; align-items: center;
    }
    .status-label { font-size: 0.8rem; color: #78909C; margin-bottom: 2px; font-weight: bold; }
    .status-val { font-size: 1.2rem; font-weight: bold; color: var(--c-primary); }

    .history-container {
        margin-top: 20px; text-align: left;
        max-height: 200px; overflow-y: auto;
    }
    .history-title { font-size: 1rem; font-weight: bold; color: var(--c-primary); border-bottom: 2px solid var(--c-primary-light); margin-bottom: 5px; }
    .history-list { list-style: none; padding: 0; margin: 0; font-size: 0.85rem; }
    .history-item {
        display: grid; grid-template-columns: 1.5fr 1fr 0.8fr 0.8fr; 
        padding: 8px 5px; border-bottom: 1px solid #eee;
        align-items: center;
    }
    .history-item:nth-child(even) { background-color: #FAFAFA; }
    .hist-date { color: #555; font-size: 0.8rem; }
    .hist-rank { color: #FFD700; text-shadow: 1px 1px 0 #FFA000; font-size: 1rem; text-align: center; }
    .hist-score { font-weight: bold; color: var(--c-primary); text-align: right; }
    .hist-time { color: #78909C; text-align: right; }

    #feedback-circle {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 260px; height: 260px;
      border: 12px solid var(--c-accent); border-radius: 50%;
      opacity: 0; pointer-events: none; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100;
    }
    #feedback-circle.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

    @media (max-width: 500px) {
      :root { --cell-size: 48px; }
      .problem-card { padding: 20px 10px; }
      .status-container { flex-direction: column; gap: 5px; }
      .history-item { grid-template-columns: 1fr 0.5fr 0.5fr 0.5fr; font-size: 0.8rem; }
    }
  </style>
</head>
<body>

  <h1 id="main-title"></h1>
  <div class="page-header">
    <span style="background:var(--c-primary); color:#fff; width:2em; height:2em; border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold;" id="page-num"></span>
    <span id="sub-title-text" style="font-weight:bold; color:var(--c-primary); margin-left:10px;"></span>
  </div>

  <div id="start-area">
    <h2 style="color:var(--c-primary); border:none; margin:0 0 20px 0;" id="start-title"></h2>
    <div style="font-size:1.1rem; line-height:1.6; margin-bottom:30px; text-align:left; background:#FFF3E0; padding:15px; border-radius:10px; border:2px solid var(--c-primary-light);" id="start-desc">
    </div>
    <button id="start-btn">スタート！ (Enter)</button>
    <div class="history-container">
        <div class="history-title">さいきんのきろく</div>
        <ul id="start-history-list" class="history-list"></ul>
    </div>
  </div>

  <div id="game-area">
    <div class="problem-number-display">
      もんだい <span id="current-q-num">1</span> / <span id="total-q-num">6</span>
    </div>

    <div class="problem-card">
      <div id="hissan-container"></div>
      <div id="feedback-circle"></div>
    </div>

    <div class="btn-area">
      <button id="check-btn">できた！ (Enter)</button>
    </div>
  </div>

  <div id="result-area" style="display:none;">
    <h2 style="color:var(--c-accent); margin:0;">全問クリア！</h2>
    <div id="result-stars" class="star-rank"></div>
    <div id="result-msg" style="font-size:1.4rem; font-weight:bold; margin:15px 0; color:#555;"></div>
    <div id="result-score" style="font-size:1.2rem; margin-bottom:10px;"></div>
    
    <div class="status-container">
        <div class="status-item">
            <span class="status-label">ハイスコア</span>
            <span class="status-val" id="high-score-val">0</span>
        </div>
        <div class="status-item">
            <span class="status-label">今日のクリア</span>
            <span class="status-val" id="daily-clear-val">0</span>
        </div>
        <div class="status-item">
            <span class="status-label">合計クリア</span>
            <span class="status-val" id="total-clear-val">0</span>
        </div>
    </div>

    <button id="retry-btn">もういちど</button>
    
    <div class="history-container">
        <div class="history-title">これまでのきろく</div>
        <ul id="result-history-list" class="history-list"></ul>
    </div>
  </div>

  <script>
    (function(){
        // ▼▼▼ 設定（Config） ▼▼▼
        const config = {
            appId: "2keta_kakeru_2keta_nocarry", 
            mainTitle: "１９　２けたをかけるかけ算の筆算",
            title: "(2けた)×(2けた)の筆算（くりあがりなし）",
            page: 86, // ページ番号
            questionCount: 6,
            targetTime: 180, // 少し短めに設定
            starThresholds: { star5: 150, star4: 120, star3: 100 },
            // スタート画面の設定
            startTitle: "計算のポイント",
            startDescription: `
                ① 位(くらい)を たてに そろえて 書く<br>
                ② 一の位から じゅんに 計算する<br>
                ③ 十の位の 計算は、答えを 左に1つ ずらす<br>
                ④ 最後に たし算を する<br>
                <br>
                <span style="color:#009688; font-weight:bold;">★くり上がりがないので、あんしんして計算しよう！</span>
            `
        };

        let problems = [];
        let currentProblemIndex = 0;
        let startTime = 0;
        let incorrectCellIds = []; 
        let currentScore = 100;
        let navigationOrder = []; 
        let incorrectInputs = []; 

        const KEY_HS = `${config.appId}:hs`;
        const KEY_CLEAR = `${config.appId}:clear`;
        const KEY_DAILY_PREFIX = `${config.appId}:daily_`;
        const KEY_HISTORY = `${config.appId}:history_v2`; 
        const KEY_RANK = `${config.appId}:rank`; 

        function loadStats() {
            const ls = localStorage;
            const today = new Date().toDateString();
            
            return {
                highScore: parseInt(ls.getItem(KEY_HS) || 0),
                totalClear: parseInt(ls.getItem(KEY_CLEAR) || 0),
                dailyClear: parseInt(ls.getItem(KEY_DAILY_PREFIX + today) || 0),
                history: JSON.parse(ls.getItem(KEY_HISTORY) || "[]")
            };
        }

        function saveStats(score, starsStr, timeSec) {
            const ls = localStorage;
            const today = new Date().toDateString();
            const currentStats = loadStats();

            if (score > currentStats.highScore) {
                ls.setItem(KEY_HS, score);
                ls.setItem(KEY_RANK, starsStr);
            }
            ls.setItem(KEY_CLEAR, currentStats.totalClear + 1);
            ls.setItem(KEY_DAILY_PREFIX + today, currentStats.dailyClear + 1);

            const now = new Date();
            const dateStr = `${now.getMonth()+1}/${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`; 
            
            const newEntry = {
                date: dateStr,
                score: score,
                stars: starsStr,
                time: timeSec
            };
            
            const newHistory = [newEntry, ...currentStats.history].slice(0, 10); 
            ls.setItem(KEY_HISTORY, JSON.stringify(newHistory));
            
            return loadStats(); 
        }

        function renderHistory(historyData, listId) {
            const listEl = document.getElementById(listId);
            listEl.innerHTML = "";
            historyData.forEach(h => {
                const li = document.createElement('li');
                li.className = 'history-item';
                li.innerHTML = `
                    <span class="hist-date">${h.date}</span>
                    <span class="hist-rank">${h.stars}</span>
                    <span class="hist-score">${h.score}点</span>
                    <span class="hist-time">${h.time}秒</span>
                `;
                listEl.appendChild(li);
            });
        }

        function updateStatsDisplay() {
            const stats = loadStats();
            document.getElementById('high-score-val').textContent = stats.highScore;
            document.getElementById('daily-clear-val').textContent = stats.dailyClear;
            document.getElementById('total-clear-val').textContent = stats.totalClear;
            
            renderHistory(stats.history, 'start-history-list');
            renderHistory(stats.history, 'result-history-list');
        }

        // ▼▼▼ 問題生成ロジック（くり上がりなし） ▼▼▼
        function generateProblems(count) {
            const arr = [];
            for(let i=0; i<count; i++) {
                let a, b;
                
                // くり上がりが発生しない数字のペアを探す
                while(true) {
                    a = Math.floor(Math.random() * 89) + 10; // 10-99
                    b = Math.floor(Math.random() * 89) + 10;
                    
                    // 条件チェック
                    // 1. かける数(b)の一の位は0ではない (基本練習のため)
                    if (b % 10 === 0) continue;

                    const a1 = Math.floor(a / 10);
                    const a0 = a % 10;
                    const b1 = Math.floor(b / 10);
                    const b0 = b % 10;

                    // 2. 部分積の計算で繰り上がりがないこと
                    // 1段目 (a * b0)
                    if (a0 * b0 >= 10) continue; // 一の位
                    if (a1 * b0 >= 10) continue; // 十の位

                    // 2段目 (a * b1)
                    if (a0 * b1 >= 10) continue; 
                    if (a1 * b1 >= 10) continue; 

                    // 3. 最後のたし算で繰り上がりがないこと
                    // p1 = a * b0 (2桁以内確定)
                    // p2 = a * b1 (2桁以内確定)
                    const p1 = a * b0;
                    const p2 = a * b1;
                    
                    // 足し算のチェック
                    // p1の一の位はそのまま降りる
                    // p1の十の位 + p2の一の位 < 10
                    const p1_tens = Math.floor(p1 / 10);
                    const p2_ones = p2 % 10;
                    if (p1_tens + p2_ones >= 10) continue;

                    // p2の十の位はそのまま降りる (繰り上がりはないので影響なし)

                    // 全条件クリア
                    break;
                }
                
                const p1 = a * (b % 10);
                const p2 = a * Math.floor(b / 10);
                const total = a * b;

                // くり上がりは発生しないので carry変数は全て0
                const addCarries = []; // 空配列

                arr.push({ 
                    a, b, p1, p2, total, 
                    carry1: 0, carry2: 0, addCarries: [],
                    inputMap: {} 
                });
            }
            return arr;
        }

        function renderCurrentProblem() {
            const container = document.getElementById('hissan-container');
            container.innerHTML = "";
            document.getElementById('feedback-circle').className = "";
            const btn = document.getElementById('check-btn');
            btn.disabled = false;
            btn.textContent = "できた！ (Enter)";

            const prob = problems[currentProblemIndex];
            document.getElementById('current-q-num').textContent = currentProblemIndex + 1;

            const grid = document.createElement('div');
            grid.className = 'hissan-grid';
            
            const cellMap = {};

            const createInput = (correctVal, cellId, type="main") => {
                const input = document.createElement('input');
                input.type = "tel";
                input.className = "input-cell"; // くり上がりメモはないので常に通常セル
                
                input.maxLength = 1;
                input.id = cellId;
                input.dataset.correct = correctVal;
                
                input.addEventListener('input', function() {
                    if (this.value.length >= 1) {
                        moveFocus(this, 1);
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === "Enter") {
                        checkAnswer();
                    } else if (e.key === "Backspace" && input.value === "") {
                        e.preventDefault();
                        moveFocus(this, -1);
                    } else if (e.key === "ArrowRight") {
                        e.preventDefault();
                        moveFocus(this, 1);
                    } else if (e.key === "ArrowLeft") {
                        e.preventDefault();
                        moveFocus(this, -1);
                    }
                });
                
                input.addEventListener('focus', function() { this.select(); });
                
                prob.inputMap[cellId] = correctVal;
                cellMap[cellId] = input;
                return input;
            };

            function moveFocus(currentInput, direction) {
                const list = incorrectInputs.length > 0 ? incorrectInputs : navigationOrder;
                const idx = list.indexOf(currentInput);
                if (idx === -1) return;

                let nextIdx = idx + direction;
                while (nextIdx >= 0 && nextIdx < list.length) {
                    if (!list[nextIdx].disabled) {
                        list[nextIdx].focus();
                        return;
                    }
                    nextIdx += direction;
                }
            }

            const addCell = (content, r, c) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                if (content instanceof HTMLElement) {
                    cell.appendChild(content);
                } else if (content) {
                    cell.textContent = content;
                }
                // くり上がりなし版なので、メモ配置ロジックは削除
                grid.appendChild(cell);
            };

            const addLine = () => {
                const lc = document.createElement('div'); lc.className = 'line-container';
                const bar = document.createElement('div'); bar.className = 'line-bar';
                lc.appendChild(bar); grid.appendChild(lc);
            };

            const aStr = String(prob.a);
            const bStr = String(prob.b);
            const p1Str = String(prob.p1);
            const p2Str = String(prob.p2);
            const totalStr = String(prob.total);

            // Row 1 & 2
            addCell("", 1, 1); addCell("", 1, 2); addCell("", 1, 3); addCell(aStr[0], 1, 4); addCell(aStr[1], 1, 5);
            addCell("", 2, 1); addCell("", 2, 2); 
            const sym = document.createElement('div'); sym.className='symbol'; sym.textContent="×";
            addCell(sym, 2, 3); addCell(bStr[0], 2, 4); addCell(bStr[1], 2, 5);
            addLine();

            // Row 3: P1
            for(let c=1; c<=5; c++) {
                const len = p1Str.length;
                if (c > 5 - len) {
                    const char = p1Str[c - (5 - len + 1)];
                    addCell(createInput(char, `r3c${c}`), 3, c);
                } else {
                    addCell("", 3, c);
                }
            }
            // Row 4: P2
            for(let c=1; c<=5; c++) {
                const len = p2Str.length;
                if (c <= 4 && c > 4 - len) {
                    const char = p2Str[c - (4 - len + 1)];
                    addCell(createInput(char, `r4c${c}`), 4, c);
                } else {
                    addCell("", 4, c);
                }
            }
            addLine();
            // Row 5: Total
            for(let c=1; c<=5; c++) {
                const len = totalStr.length;
                if (c > 5 - len) {
                    const char = totalStr[c - (5 - len + 1)];
                    addCell(createInput(char, `r5c${c}`), 5, c);
                } else {
                    addCell("", 5, c);
                }
            }
            container.appendChild(grid);
            
            // --- ナビゲーション順序 ---
            navigationOrder = [];
            const pushIfExists = (id) => { if (cellMap[id]) navigationOrder.push(cellMap[id]); };

            // 1. P1 (メモなし)
            pushIfExists(`r3c5`); // Ones
            pushIfExists(`r3c4`); // Tens
            pushIfExists(`r3c3`); // Hundreds (ある場合)
            
            // 2. P2 (メモなし)
            pushIfExists(`r4c4`); // Ones (Shifted)
            pushIfExists(`r4c3`); // Tens
            pushIfExists(`r4c2`); // Hundreds (ある場合)

            // 3. Total (右から左)
            pushIfExists(`r5c5`);
            pushIfExists(`r5c4`);
            pushIfExists(`r5c3`);
            pushIfExists(`r5c2`);
            pushIfExists(`r5c1`);

            if(navigationOrder.length > 0) navigationOrder[0].focus();
        }

        function checkAnswer() {
            let allCorrect = true;
            incorrectInputs = []; 

            navigationOrder.forEach(input => {
                const correct = input.dataset.correct;
                const parentCell = input.closest('.cell');
                
                input.classList.remove('correct', 'wrong');
                if(parentCell && input.classList.contains('input-cell')) {
                    parentCell.classList.remove('correct-bg', 'wrong-bg');
                }
                
                if (input.value === correct) {
                    input.classList.add('correct');
                    if(parentCell && input.classList.contains('input-cell')) parentCell.classList.add('correct-bg');
                    input.disabled = true; 
                } else {
                    allCorrect = false;
                    input.classList.add('wrong');
                    if(parentCell && input.classList.contains('input-cell')) parentCell.classList.add('wrong-bg');
                    incorrectInputs.push(input);
                }
            });

            if (allCorrect) {
                document.getElementById('feedback-circle').classList.add('show');
                document.getElementById('check-btn').disabled = true;
                document.getElementById('check-btn').textContent = "せいかい！";
                
                if(window.confetti) confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });

                setTimeout(() => {
                    currentProblemIndex++;
                    if (currentProblemIndex >= config.questionCount) {
                        showResult();
                    } else {
                        renderCurrentProblem();
                    }
                }, 1200);
            } else {
                currentScore = Math.max(0, currentScore - 5);
                if (incorrectInputs.length > 0) {
                    incorrectInputs[0].focus();
                }
            }
        }

        function showResult() {
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';

            const timeSec = Math.floor((Date.now() - startTime) / 1000);
            let finalScore = currentScore;
            
            if (timeSec < config.targetTime) {
                finalScore += Math.floor((config.targetTime - timeSec) * 0.5); 
            }

            let stars = "★☆☆☆☆";
            let msg = "もう少し！";
            if (finalScore >= config.starThresholds.star5) { stars = "★★★★★"; msg = "すばらしい！計算マスター！"; }
            else if (finalScore >= config.starThresholds.star4) { stars = "★★★★☆"; msg = "よくがんばったね！"; }
            else if (finalScore >= config.starThresholds.star3) { stars = "★★★☆☆"; msg = "合格！その調子！"; }
            else if (finalScore >= 80) { stars = "★★☆☆☆"; msg = "あとすこし！"; }

            document.getElementById('result-stars').textContent = stars;
            document.getElementById('result-msg').textContent = msg;
            document.getElementById('result-score').innerHTML = `スコア: <strong>${finalScore}</strong> 点<br><span style="font-size:1rem; color:#888;">タイム: ${timeSec}秒</span>`;
            
            saveStats(finalScore, stars, timeSec);
            updateStatsDisplay();

            if (finalScore >= 100 && window.confetti) {
                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
            }
        }

        function initGame() {
            problems = generateProblems(config.questionCount);
            currentProblemIndex = 0;
            currentScore = 100;
            incorrectInputs = [];
            startTime = Date.now();

            document.getElementById('start-area').style.display = 'none';
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('game-area').style.display = 'flex';
            
            renderCurrentProblem();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Config内容を反映
            document.getElementById('main-title').textContent = config.mainTitle;
            document.getElementById('page-num').textContent = config.page;
            document.getElementById('sub-title-text').textContent = config.title;
            document.getElementById('start-title').textContent = config.startTitle;
            document.getElementById('start-desc').innerHTML = config.startDescription;
            document.getElementById('total-q-num').textContent = config.questionCount;
            
            updateStatsDisplay(); 

            document.getElementById('start-btn').addEventListener('click', initGame);
            document.getElementById('retry-btn').addEventListener('click', initGame);
            document.getElementById('check-btn').addEventListener('click', checkAnswer);

            document.addEventListener('keydown', (e) => {
                if (e.key === "Enter") {
                    if (document.getElementById('start-area').style.display !== 'none') {
                        initGame();
                    } else if (document.getElementById('result-area').style.display !== 'none') {
                        initGame();
                    }
                }
            });
        });

    })();
  </script>
</body>
</html>