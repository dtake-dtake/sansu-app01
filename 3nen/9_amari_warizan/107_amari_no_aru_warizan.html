<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ã¾ã‚Šã®ã‚ã‚‹ã‚ã‚Šç®—ã®ç·´ç¿’</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* â–¼â–¼â–¼ ãƒ†ãƒ¼ãƒï¼šã‚ãã‚ããƒ•ã‚©ãƒ¬ã‚¹ãƒˆï¼ˆå…ƒæ°—ãªæ£®ï¼‰ â–¼â–¼â–¼ */
        :root {
            --c-bg-main: #F1F8E9;         /* è–„ã„é»„ç·‘ */
            --c-primary: #689F38;         /* æ£®ã®ç·‘ */
            --c-primary-dark: #33691E;    /* æ¿ƒã„ç·‘ */
            --c-primary-light: #C5E1A5;   /* æ˜ã‚‹ã„ç·‘ */
            --c-accent: #FF8F00;          /* æœ¨ã®å®Ÿã®ã‚ˆã†ãªã‚ªãƒ¬ãƒ³ã‚¸ */
            
            --c-button-bg: #7CB342;       
            --c-button-hover: #558B2F;    
            
            --c-result-area-bg: #ffffff;
            --c-problem-row-bg: #ffffff;
            --c-history-bg: #DCEDC8;      
            
            --c-text-main: #3E2723;       /* æœ¨ã®å¹¹ã®ã‚ˆã†ãªã“ã’èŒ¶ */
            --c-text-on-button: #ffffff;
            
            --c-feedback-correct-bg: #C8E6C9; 
            --c-feedback-wrong-bg: #FFCDD2;
            
            --font-family: "Hiragino Kaku Gothic ProN", "MS PGothic", sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--c-bg-main); color: var(--c-text-main);
            padding: 20px; display: flex; flex-direction: column; align-items: center;
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
        }

        h1, h2 { text-align: center; color: var(--c-primary-dark); margin: 10px 0; }
        h1 { font-size: 1.4rem; }
        
        h2 { 
            font-size: 1.3rem; 
            background: var(--c-primary-light); 
            padding: 8px 20px; 
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 2px solid var(--c-primary);
            color: var(--c-primary-dark);
        }

        .page-circle {
            display: inline-flex; justify-content: center; align-items: center;
            width: 2.0rem; height: 2.0rem; border-radius: 50%;
            background-color: #fff; color: var(--c-primary-dark);
            border: 2px solid var(--c-primary-dark);
            font-weight: bold; font-size: 1.0rem; line-height: 1; flex-shrink: 0;
        }

        #problems-container {
            display: flex; flex-direction: column; gap: 15px;
            width: 100%; max-width: 600px; margin-top: 20px;
        }
        
        .problem-wrapper {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--c-problem-row-bg); border-radius: 12px; padding: 15px 20px;
            box-shadow: 0 4px 0 rgba(104, 159, 56, 0.2);
            border: 2px solid var(--c-primary-light);
            transition: transform 0.2s;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .problem-text {
            font-size: 1.6rem; font-weight: bold; 
            color: var(--c-text-main);
            min-width: 120px;
        }

        .answer-area {
            display: flex; align-items: center; gap: 8px; flex-grow: 1; justify-content: flex-end;
        }

        .input-box {
            width: 60px; height: 50px; text-align: center; font-size: 1.6rem;
            border: 2px solid #B0BEC5; border-radius: 8px;
            background-color: #FAFAFA; color: var(--c-text-main);
            font-weight: bold; outline: none;
            transition: all 0.2s;
        }

        .input-box:focus {
             border-color: var(--c-accent);
             box-shadow: 0 0 0 3px rgba(255, 143, 0, 0.2);
             background-color: #FFF8E1;
             transform: scale(1.05);
        }

        .input-box.wrong-bg { background-color: var(--c-feedback-wrong-bg); border-color: #E57373; color: #C62828; }
        .input-box.correct-bg { background-color: var(--c-feedback-correct-bg); border-color: #81C784; }

        .label-amari { font-weight: bold; font-size: 1.1rem; color: var(--c-primary); }

        button {
            font-size: 1.2rem; padding: 12px 30px; border: none; border-radius: 50px;
            background-color: var(--c-button-bg); color: var(--c-text-on-button);
            cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; font-weight: bold;
            box-shadow: 0 4px 0 var(--c-primary-dark);
        }
        button:active { transform: translateY(4px); box-shadow: none; }
        button:disabled { background-color: #B0BEC5; box-shadow: none; cursor: not-allowed; transform: none;}
        
        .button-area { text-align: center; margin: 40px 0; }
        #start-area { text-align: center; margin: 60px 0; }
        #start-btn { font-size: 1.5rem; padding: 15px 50px; background-color: var(--c-accent); box-shadow: 0 5px 0 #E65100; }
        
        #result-area {
            display: none; width: 90%; max-width: 600px; margin: 20px auto; padding: 25px;
            background: var(--c-result-area-bg); border-radius: 15px; text-align: center;
            border: 4px solid var(--c-primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        #result { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; color: var(--c-accent); }
        
        .status-stars { font-size: 2.5rem; color: #FFD700; text-shadow: 2px 2px 0 #FFA000; display: block; margin-bottom: 10px; }
        
        /* ãƒªã‚¶ãƒ«ãƒˆã®çµ±è¨ˆã‚¨ãƒªã‚¢ */
        .stats-container {
            display: flex; justify-content: center; gap: 20px; margin-bottom: 15px;
        }
        .stat-box {
            background-color: #F1F8E9; border: 1px solid #C5E1A5;
            padding: 10px 15px; border-radius: 10px;
            display: flex; flex-direction: column;
            min-width: 100px;
        }
        .stat-label { font-size: 0.9rem; color: var(--c-primary-dark); font-weight: bold; }
        .stat-value { font-size: 1.4rem; color: var(--c-accent); font-weight: 800; }
        
        #history-list { list-style: none; padding: 0; background: var(--c-history-bg); border-radius: 8px; margin-top:15px; text-align: left; padding: 10px;}
        #history-list li { border-bottom: 1px dashed #AED581; padding: 8px; font-size: 0.95rem; display: flex; justify-content: space-between;}
        #history-list li:last-child { border-bottom: none; }

        #bulb-btn {
            position: absolute; top: 15px; right: 15px;
            width: 45px; height: 45px; border-radius: 50%;
            background: #fff; border: 2px solid #FFD700; 
            font-size: 1.5rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100;
        }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
        .modal-content { background-color: #fff; margin: 15% auto; padding: 25px; border: 4px solid var(--c-primary); border-radius: 15px; width: 85%; max-width: 450px; position: relative;}
        .close-modal { position: absolute; top: 10px; right: 15px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-body { text-align: left; line-height: 1.8; font-size: 1.05rem; }

        @media (max-width: 480px) {
            .problem-text { font-size: 1.4rem; }
            .input-box { width: 50px; height: 45px; font-size: 1.4rem; }
            h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <button id="bulb-btn" aria-label="èª¬æ˜ã‚’è¡¨ç¤º">ğŸ’¡</button>
    <div id="info-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 style="text-align:center; color:var(--c-primary); margin-top:0;">å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
        <div class="modal-body" id="instruction-content"></div>
      </div>
    </div>
    
    <h1 id="main-title"></h1>
    <h2 id="sub-title">
        <span id="page-circle" class="page-circle"></span>
        <span id="sub-title-text"></span>
    </h2>
    
    <div id="start-area"> 
        <div style="margin-bottom:20px; font-size:1.1rem;">
            å…¨<span id="q-count-disp"></span>å•ãƒ»ç›®æ¨™ã‚¿ã‚¤ãƒ  <span id="target-time-disp"></span>ç§’
        </div>
        <button id="start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆï¼ (Enter)</button> 
        
        <div style="margin-top:30px; font-size:0.9rem; color:#555;">
            <div id="start-stats" style="margin-bottom:10px;">
                ä»Šæ—¥ã®ã‚¯ãƒªã‚¢ï¼š<span class="daily-val" style="font-weight:bold; color:var(--c-accent);">0</span>å› ï¼ 
                åˆè¨ˆï¼š<span class="total-val" style="font-weight:bold;">0</span>å›
            </div>
        </div>
    </div>

    <div id="problems-section" style="display:none;">
        <div id="problems-container"></div>
        <div class="button-area">
            <button id="check-answers">ã¾ã‚‹ã¤ã‘</button>
        </div>
    </div>

    <div id="result-area">
        <div id="result"></div>
        <div class="status-stars" id="result-stars"></div>
        
        <div class="stats-container">
            <div class="stat-box">
                <span class="stat-label">ã‚¹ã‚³ã‚¢</span>
                <span class="stat-value" id="result-score">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">ã‚¿ã‚¤ãƒ </span>
                <span class="stat-value" id="result-time">0</span>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-box">
                <span class="stat-label">ä»Šæ—¥ã®ã‚¯ãƒªã‚¢</span>
                <span class="stat-value daily-val">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">åˆè¨ˆã‚¯ãƒªã‚¢</span>
                <span class="stat-value total-val">0</span>
            </div>
        </div>
        
        <div style="background:#F1F8E9; padding:10px; border-radius:10px; margin-top:10px;">
            <div id="highScoreArea" style="font-weight:bold; color:var(--c-primary-dark);">ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼š<span id="highScoreValue">0</span> ç‚¹</div>
        </div>

        <div id="history-area" style="margin-top:15px; font-size:0.9rem;">
            <div style="font-weight:bold; margin-bottom:5px;">ã“ã‚Œã¾ã§ã®ãã‚ãï¼ˆæœ€æ–°5ä»¶ï¼‰</div>
            <ul id="history-list"></ul>
        </div>
        
        <div style="margin-top:20px; text-align:center;">
             <button id="back-to-start" style="background-color:var(--c-primary);">ã‚¿ã‚¤ãƒˆãƒ«ã¸ (Enter)</button>
             <div style="margin-top:15px;">
                <button id="reset-highscore" style="font-size:0.8rem; padding:5px 10px; background:#90A4AE; box-shadow:none;">è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
             </div>
        </div>
    </div>

    <script>
    (function () {
      const config = {
        appId: "amari_no_aru_warizan",
        mainTitle: "ï¼™ã€€ã‚ã¾ã‚Šã®ã‚ã‚‹ã‚ã‚Šç®—",
        title: "ã‚ã¾ã‚Šã®ã‚ã‚‹ã‚ã‚Šç®—ã®ç·´ç¿’", 
        page: 107, 
        baseScore: 100,
        targetTimePerQuestion: 8, // 1å•8ç§’è¨ˆç®—
        questionCount: 10,
        starThresholds: { star1: 100, star2: 120, star3: 140, star4: 160, star5: 180 },
        
        instructionHtml: `
          <p>ä¹ä¹ã‚’ä½¿ã£ã¦ã€ç­”ãˆã¨ã‚ã¾ã‚Šã‚’ã‚‚ã¨ã‚ã¾ã—ã‚‡ã†ã€‚</p>
          <div style="background:#FFFDE7; padding:15px; border-radius:10px; border:2px solid #FFF59D; margin-bottom:10px;">
             <strong>ã‚Œã„ï¼š 14 Ã· 4</strong><br>
             4ã®ã ã‚“ã®ä¹ä¹ã‚’ä½¿ã†ã¨â€¦<br>
             4 Ã— 3 = 12<br>
             14 - 12 = 2<br>
             ç­”ãˆã¯ <strong>3 ã‚ã¾ã‚Š 2</strong>
          </div>
          <p style="color:#D84315; font-weight:bold;">â€»ã‚ã¾ã‚Šã¯ã€ã‚ã‚‹æ•°ã‚ˆã‚Šå°ã•ããªã‚‹ã‚ˆï¼</p>
        `,

        problemGenerator(count) {
            const problems = [];
            while(problems.length < count) {
                const divisor = Math.floor(Math.random() * 8) + 2; // 2ã€œ9
                const quotient = Math.floor(Math.random() * 9) + 1; // 1ã€œ9
                const maxRemainder = divisor - 1;
                const remainder = Math.floor(Math.random() * maxRemainder) + 1;
                const dividend = divisor * quotient + remainder;

                const key = `${dividend}Ã·${divisor}`;
                if (problems.some(p => `${p.dividend}Ã·${p.divisor}` === key)) continue;

                problems.push({ dividend, divisor, quotient, remainder });
            }
            return problems;
        }
      };

      let problems = [];
      let startTime = 0;
      let incorrectInputIds = []; 
      let highScore = 0;
      let totalClearCount = 0;
      let dailyClearCount = 0;
      
      const ls = localStorage;
      const KEY_HS = `${config.appId}:hs`;
      const KEY_HISTORY = `${config.appId}:history`;
      const KEY_TOTAL_CLEAR = `${config.appId}:totalClear`;
      
      // ä»Šæ—¥ã®æ—¥ä»˜ã‚­ãƒ¼ (YYYY-MM-DD)
      function getDailyKey() {
          const now = new Date();
          return `${config.appId}:dailyClear-${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
      }

      function loadData() { 
          highScore = parseInt(ls.getItem(KEY_HS)) || 0; 
          totalClearCount = parseInt(ls.getItem(KEY_TOTAL_CLEAR)) || 0;
          dailyClearCount = parseInt(ls.getItem(getDailyKey())) || 0;
          updateStatsDisplay();
      }
      
      function saveData(score) {
          if (score > highScore) {
              highScore = score;
              ls.setItem(KEY_HS, highScore);
          }
          
          totalClearCount++;
          dailyClearCount++;
          ls.setItem(KEY_TOTAL_CLEAR, totalClearCount);
          ls.setItem(getDailyKey(), dailyClearCount);

          const history = JSON.parse(ls.getItem(KEY_HISTORY) || '[]');
          const now = new Date();
          const dateStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
          history.unshift({ date: dateStr, score: score });
          if (history.length > 5) history.pop();
          ls.setItem(KEY_HISTORY, JSON.stringify(history));
          
          updateStatsDisplay();
      }

      function updateStatsDisplay() {
          document.getElementById('highScoreValue').textContent = highScore;
          document.querySelectorAll('.total-val').forEach(el => el.textContent = totalClearCount);
          document.querySelectorAll('.daily-val').forEach(el => el.textContent = dailyClearCount);

          const history = JSON.parse(ls.getItem(KEY_HISTORY) || '[]');
          const list = document.getElementById('history-list');
          if (history.length === 0) {
              list.innerHTML = '<li>ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</li>';
          } else {
              list.innerHTML = history.map(h => `<li><span>${h.date}</span> <strong>${h.score}ç‚¹</strong></li>`).join('');
          }
      }

      function displayProblems() {
          const container = document.getElementById('problems-container');
          container.innerHTML = '';
          
          problems.forEach((p, index) => {
              const div = document.createElement('div');
              div.className = 'problem-wrapper';
              div.innerHTML = `
                  <div class="problem-text">
                    ${index + 1}. &nbsp; ${p.dividend} Ã· ${p.divisor}
                  </div>
                  <div class="answer-area">
                      ï¼ <input type="tel" inputmode="numeric" class="input-box q-box" id="ans-q-${index}" data-index="${index}" placeholder="">
                      <span class="label-amari">ã‚ã¾ã‚Š</span>
                      <input type="tel" inputmode="numeric" class="input-box r-box" id="ans-r-${index}" data-index="${index}" placeholder="">
                  </div>
              `;
              container.appendChild(div);
          });
      }

      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ãŠã‚ˆã³å…¥åŠ›ç›£è¦–ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
      function setupInputEvents() {
          const allInputs = Array.from(document.querySelectorAll('.input-box'));
          
          allInputs.forEach((input, i) => {
              // 1. ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
              input.addEventListener('focus', (e) => {
                  e.target.select();
                  setTimeout(() => {
                      const wrapper = e.target.closest('.problem-wrapper');
                      wrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }, 10);
              });

              // 2. å•†(q-box)ã«å…¥åŠ›ãŒã‚ã£ãŸã‚‰ã€å³åº§ã«ä½™ã‚Š(r-box)ã¸ç§»å‹•
              input.addEventListener('input', (e) => {
                  if (input.classList.contains('q-box')) {
                      // 1æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã•ã‚ŒãŸã‚‰ç§»å‹•ï¼ˆå•†ã¯1æ¡ç¢ºå®šã®ãŸã‚ï¼‰
                      if (input.value.length >= 1) {
                          // åŒã˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®r-boxã‚’æ¢ã™
                          const idx = input.dataset.index;
                          const rBox = document.getElementById(`ans-r-${idx}`);
                          if (rBox) rBox.focus();
                      }
                  }
              });

              // 3. ã‚­ãƒ¼ãƒ€ã‚¦ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆBackspaceæˆ»ã‚Š & Enterç§»å‹•ï¼‰
              input.addEventListener('keydown', (e) => {
                  // --- Enterã‚­ãƒ¼åˆ¶å¾¡ ---
                  if (e.key === 'Enter') {
                      e.preventDefault();
                      
                      // é–“é•ã„è¨‚æ­£ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                      if (incorrectInputIds.length > 0) {
                          const currentIdIndex = incorrectInputIds.indexOf(input.id);
                          if (currentIdIndex !== -1 && currentIdIndex < incorrectInputIds.length - 1) {
                              const nextInput = document.getElementById(incorrectInputIds[currentIdIndex + 1]);
                              if(nextInput) nextInput.focus();
                          } else {
                              document.getElementById('check-answers').focus();
                          }
                          return;
                      }

                      // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                      const currentIndex = allInputs.indexOf(input);
                      if (currentIndex < allInputs.length - 1) {
                          allInputs[currentIndex + 1].focus();
                      } else {
                          document.getElementById('check-answers').focus();
                      }
                  }
                  
                  // --- Backspaceã‚­ãƒ¼åˆ¶å¾¡ ---
                  if (e.key === 'Backspace') {
                      // å…¥åŠ›æ¬„ãŒç©ºã®çŠ¶æ…‹ã§BackspaceãŒæŠ¼ã•ã‚ŒãŸã‚‰æˆ»ã‚‹
                      if (input.value === '') {
                          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯ãªã©ï¼‰é˜²æ­¢
                          const currentIndex = allInputs.indexOf(input);
                          if (currentIndex > 0) {
                              const prevInput = allInputs[currentIndex - 1];
                              prevInput.focus();
                              // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¾Œã«å…¨é¸æŠï¼ˆfocusã‚¤ãƒ™ãƒ³ãƒˆã§ã‚‚selectã—ã¦ã„ã‚‹ãŒã€å¿µã®ãŸã‚é…å»¶å®Ÿè¡Œï¼‰
                              setTimeout(() => prevInput.select(), 10);
                          }
                      }
                  }
              });
          });
      }

      function checkAnswers() {
          const btn = document.getElementById('check-answers');
          let allCorrect = true;
          incorrectInputIds = [];

          problems.forEach((p, index) => {
              const qInput = document.getElementById(`ans-q-${index}`);
              const rInput = document.getElementById(`ans-r-${index}`);
              const qVal = parseInt(qInput.value);
              const rVal = parseInt(rInput.value);

              qInput.classList.remove('correct-bg', 'wrong-bg');
              rInput.classList.remove('correct-bg', 'wrong-bg');

              if (qVal === p.quotient) qInput.classList.add('correct-bg');
              else {
                  qInput.classList.add('wrong-bg');
                  incorrectInputIds.push(qInput.id);
                  allCorrect = false;
              }

              if (rVal === p.remainder) rInput.classList.add('correct-bg');
              else {
                  rInput.classList.add('wrong-bg');
                  incorrectInputIds.push(rInput.id);
                  allCorrect = false;
              }
          });

          if (allCorrect) {
              finishGame();
          } else {
              btn.textContent = "ãªãŠã—ã¦ ã‚‚ã†ã„ã¡ã©";
              if (incorrectInputIds.length > 0) {
                  const firstWrong = document.getElementById(incorrectInputIds[0]);
                  if (firstWrong) {
                      firstWrong.focus();
                      setTimeout(() => firstWrong.select(), 50);
                  }
              }
          }
      }

      function finishGame() {
          const elapsed = (Date.now() - startTime) / 1000;
          const targetTime = config.targetTimePerQuestion * config.questionCount;
          
          let timeBonus = 0;
          if (elapsed < targetTime) {
              timeBonus = Math.floor((targetTime - elapsed) * 2); 
          }
          let score = config.baseScore + timeBonus;
          if (score > 200) score = 200;

          document.getElementById('problems-section').style.display = 'none';
          document.getElementById('result-area').style.display = 'block';

          let stars = "â˜…â˜†â˜†â˜†â˜†";
          if (score >= config.starThresholds.star5) stars = "â˜…â˜…â˜…â˜…â˜…";
          else if (score >= config.starThresholds.star4) stars = "â˜…â˜…â˜…â˜…â˜†";
          else if (score >= config.starThresholds.star3) stars = "â˜…â˜…â˜…â˜†â˜†";
          else if (score >= config.starThresholds.star2) stars = "â˜…â˜…â˜†â˜†â˜†";

          document.getElementById('result').innerHTML = `å…¨å•ã›ã„ã‹ã„ï¼<br><span style="color:#33691E;">ãŠã‚ã§ã¨ã†ï¼</span>`;
          document.getElementById('result-stars').textContent = stars;
          
          document.getElementById('result-score').textContent = score + "ç‚¹";
          document.getElementById('result-time').textContent = elapsed.toFixed(1) + "ç§’";
          
          if (score >= config.starThresholds.star5 && typeof confetti === 'function') {
              confetti({ particleCount: 150, spread: 160, colors: ['#AED581', '#FFB74D', '#FFFFFF'] });
          }

          saveData(score);
          setTimeout(() => document.getElementById('back-to-start').focus(), 100);
      }

      function initGame() {
          problems = config.problemGenerator(config.questionCount);
          incorrectInputIds = [];
          document.getElementById('start-area').style.display = 'none';
          document.getElementById('result-area').style.display = 'none';
          document.getElementById('problems-section').style.display = 'block';
          document.getElementById('check-answers').textContent = "ã¾ã‚‹ã¤ã‘";
          
          displayProblems();
          setupInputEvents();
          
          startTime = Date.now();
          
          setTimeout(() => {
              const first = document.getElementById('ans-q-0');
              if(first) first.focus();
          }, 100);
      }
      
      function resetTitle() {
          document.getElementById('result-area').style.display = 'none';
          document.getElementById('start-area').style.display = 'block';
          document.getElementById('start-btn').focus();
      }

      document.addEventListener('DOMContentLoaded', () => {
          document.getElementById('main-title').textContent = config.mainTitle;
          document.getElementById('page-circle').textContent = config.page;
          document.getElementById('sub-title-text').textContent = config.title;
          document.getElementById('instruction-content').innerHTML = config.instructionHtml;
          document.getElementById('q-count-disp').textContent = config.questionCount;
          document.getElementById('target-time-disp').textContent = config.targetTimePerQuestion * config.questionCount;

          loadData();

          const modal = document.getElementById("info-modal");
          document.getElementById("bulb-btn").onclick = () => modal.style.display = "block";
          document.querySelector(".close-modal").onclick = () => modal.style.display = "none";
          window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; };

          document.getElementById('start-btn').onclick = initGame;
          document.getElementById('check-answers').onclick = checkAnswers;
          document.getElementById('back-to-start').onclick = resetTitle;
          
          document.getElementById('reset-highscore').onclick = () => {
              if(confirm("ã™ã¹ã¦ã®è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
                  highScore = 0;
                  totalClearCount = 0;
                  dailyClearCount = 0;
                  ls.clear();
                  loadData();
              }
          };

          // ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢/ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã§ã®ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼åˆ¶å¾¡
          document.addEventListener('keydown', (e) => {
              // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºä¸­ã¯ä½•ã‚‚ã—ãªã„
              const modal = document.getElementById('info-modal');
              if (modal.style.display === 'block') return;

              if (e.key === 'Enter') {
                  // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆinput-boxï¼‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒã‚ã‚‹ã¨ãã¯ä½•ã‚‚ã—ãªã„ï¼ˆå€‹åˆ¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã§å‡¦ç†ï¼‰
                  if (document.activeElement.classList.contains('input-box')) return;

                  const startArea = document.getElementById('start-area');
                  const resultArea = document.getElementById('result-area');
                  
                  if (startArea.style.display !== 'none') {
                      initGame();
                  } else if (resultArea.style.display !== 'none') {
                      resetTitle();
                  }
              }
          });
          
          document.getElementById('start-btn').focus();
      });
    })();
    </script>
</body>
</html>